/*****************************************************************************
 *      ソフトウェアライブラリ
 *
 *      Copyright (c) 1994 SEGA
 *
 * Library: ファイルローダ
 * Module : サンプル１
 * File   : smpfld01.c
 * Date   : 1995-10-02
 * Version: 1.00
 * Auther : N.K
 *
 *      ゲームの単純な起動。
 *
 *****************************************************************************/

/*****************************************************************************
 *      インクルードファイル
 *****************************************************************************/


/*****************************************************************************/
#include <machine.h>
#include  <sl_def.h>
#include  <fld_load.h>
#include  <sega_def.h>
#include  <sega_gfs.h>
#include  <sega_int.h>
#include  <sega_scl.h>
#include  <sega_per.h>
#include  <per_x.h>
//#include    "string.h"

#define TITI 1
#define BITMAP_PIXEL_WIDTH  320
#define BITMAP_PIXEL_HEIGHT 240
#define	NBG1_VDP2_VRAM_BASE_ADDR	SCL_VDP2_VRAM_B0




/*****************************************************************************
 *      定数マクロ
 *****************************************************************************/
/* 同時にオープンするファイルの数 */
#define MAX_OPEN        2

/* ルートディレクトリにあるファイル数 */
#define MAX_DIR         40

/* アクセスするファイル名 */
//#define FOLDERNAME	"FRR"
//#define FNAME           "FRR_IP.BIN"

/*****************************************************************************
 *      関数の宣言
 *****************************************************************************/
extern	void	exit(Sint32);
/*****************************************************************************
 *      変数の定義
 *****************************************************************************/
/* ライブラリ作業領域 */
Uint32 lib_work[GFS_WORK_SIZE(MAX_OPEN) / sizeof(Uint32)];

/* ディレクトリ情報管理領域 */
GfsDirTbl dirtbl; 

/* ディレクトリ情報格納領域 */
GfsDirName dirname[MAX_DIR];

SysPort		*__port;
const SysDevice	*device;
trigger_t	pltrigger[2],pltriggerE[2];


void toto(char *);
/*****************************************************************************
 *      関数の定義
 *****************************************************************************/

void	UsrVblankIn( void ){
	SCL_VblankStart();
}


void   UsrVblankOut( void ){
	SCL_VblankEnd();
	PER_GetPort(__port);
}

void	SetVblank( void ){
	
	/* V-Blank割り込みルーチンの登録 */
	INT_ChgMsk(INT_MSK_NULL,INT_MSK_VBLK_IN | INT_MSK_VBLK_OUT);
	INT_SetScuFunc(INT_SCU_VBLK_IN,UsrVblankIn);
	INT_SetScuFunc(INT_SCU_VBLK_OUT,UsrVblankOut);
	INT_ChgMsk(INT_MSK_VBLK_IN | INT_MSK_VBLK_OUT,INT_MSK_NULL);

	__port = PER_OpenPort();
}


	Uint16	FntXsize;
	Uint16	FntYsize;
	Uint8	FntContry;
	Uint8	FntBitPat[8] = {0x80,0x40,0x20,0x10,0x08,0x04,0x02,0x01};

void  FNT_SetBuffSize(Uint16 x,Uint16 y,Uint8 contry)
{
	FntXsize  = x;
	FntYsize  = y;
	FntContry = contry;
}

extern	Uint8	FntKanaFontData[]; /* 8x16 ASCII Font かな部分 */
extern	Uint8	FntEouFontData[];  /* 8x16 ASCII Font ヨーロッパ文字？部分 */


Uint8	FntAsciiFontData[] = {
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x00,0x10,0x10,0x00,
	0x00,0x00,0x24,0x24,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x44,0x44,0xfe,0x44,0x44,0x44,0x44,0x44,0x44,0xfe,0x44,0x44,0x00,0x00,
	0x00,0x00,0x10,0x10,0x7c,0x92,0x90,0x90,0x7c,0x12,0x12,0x92,0x7c,0x10,0x10,0x00,
	0x00,0x00,0x00,0x60,0x90,0x92,0x64,0x08,0x10,0x20,0x4c,0x92,0x12,0x0c,0x00,0x00,
	0x00,0x00,0x18,0x24,0x24,0x24,0x18,0x30,0x53,0x52,0x8a,0x8a,0x44,0x46,0x39,0x00,
	0x00,0x00,0x10,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x04,0x08,0x08,0x10,0x10,0x30,0x20,0x20,0x30,0x10,0x10,0x08,0x08,0x04,0x00,
	0x00,0x20,0x10,0x10,0x08,0x08,0x0c,0x04,0x04,0x0c,0x08,0x08,0x10,0x10,0x20,0x00,
	0x00,0x00,0x00,0x00,0x10,0x92,0x54,0x38,0x10,0x38,0x54,0x92,0x10,0x00,0x00,0x00,
	0x00,0x00,0x00,0x10,0x10,0x10,0x10,0x10,0x7c,0x10,0x10,0x10,0x10,0x10,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x18,0x08,0x10,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7e,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x00,
	0x00,0x02,0x02,0x02,0x04,0x04,0x08,0x08,0x10,0x10,0x20,0x20,0x40,0x40,0x40,0x00,
	0x00,0x18,0x24,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x24,0x18,0x00,
	0x00,0x10,0x30,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x38,0x00,
	0x00,0x18,0x24,0x42,0x42,0x02,0x04,0x04,0x08,0x10,0x20,0x20,0x40,0x40,0x7e,0x00,
	0x00,0x18,0x24,0x42,0x42,0x02,0x04,0x18,0x04,0x02,0x02,0x42,0x42,0x24,0x18,0x00,
	0x00,0x0c,0x14,0x14,0x24,0x24,0x44,0x44,0x44,0x44,0x7e,0x04,0x04,0x04,0x0e,0x00,
	0x00,0x7e,0x40,0x40,0x40,0x40,0x58,0x64,0x42,0x02,0x02,0x42,0x42,0x24,0x18,0x00,
	0x00,0x18,0x24,0x42,0x42,0x40,0x58,0x64,0x42,0x42,0x42,0x42,0x42,0x24,0x18,0x00,
	0x00,0x7e,0x42,0x42,0x42,0x04,0x04,0x08,0x08,0x10,0x10,0x20,0x20,0x40,0x40,0x00,
	0x00,0x18,0x24,0x42,0x42,0x42,0x24,0x18,0x24,0x42,0x42,0x42,0x42,0x24,0x18,0x00,
	0x00,0x18,0x24,0x42,0x42,0x42,0x42,0x26,0x1a,0x02,0x02,0x42,0x42,0x24,0x18,0x00,
	0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00,
	0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x08,0x08,0x10,0x00,
	0x00,0x00,0x00,0x02,0x04,0x08,0x10,0x20,0x40,0x20,0x10,0x08,0x04,0x02,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7e,0x00,0x00,0x7e,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x40,0x20,0x10,0x08,0x04,0x02,0x04,0x08,0x10,0x20,0x40,0x00,0x00,
	0x00,0x18,0x24,0x42,0x42,0x02,0x04,0x08,0x10,0x10,0x10,0x00,0x00,0x10,0x10,0x00,
	0x00,0x38,0x44,0x82,0x92,0xaa,0xaa,0xaa,0xaa,0xaa,0xaa,0x94,0x80,0x40,0x3c,0x00,
	0x00,0x18,0x24,0x42,0x42,0x42,0x42,0x7e,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x00,
	0x00,0x78,0x44,0x42,0x42,0x42,0x44,0x78,0x44,0x42,0x42,0x42,0x42,0x44,0x78,0x00,
	0x00,0x18,0x24,0x42,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x42,0x24,0x18,0x00,
	0x00,0x78,0x44,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x44,0x78,0x00,
	0x00,0x7e,0x40,0x40,0x40,0x40,0x40,0x7c,0x40,0x40,0x40,0x40,0x40,0x40,0x7e,0x00,
	0x00,0x7e,0x40,0x40,0x40,0x40,0x40,0x7c,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x00,
	0x00,0x18,0x24,0x42,0x40,0x40,0x40,0x5e,0x42,0x42,0x42,0x42,0x42,0x26,0x1a,0x00,
	0x00,0x42,0x42,0x42,0x42,0x42,0x42,0x7e,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x00,
	0x00,0x38,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x38,0x00,
	0x00,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x42,0x24,0x18,0x00,
	0x00,0x42,0x44,0x44,0x48,0x48,0x50,0x60,0x50,0x48,0x48,0x44,0x44,0x42,0x42,0x00,
	0x00,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x7e,0x00,
	0x00,0x42,0x42,0x66,0x66,0x5a,0x5a,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x00,
	0x00,0x42,0x42,0x62,0x62,0x52,0x52,0x4a,0x4a,0x46,0x46,0x42,0x42,0x42,0x42,0x00,
	0x00,0x3c,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x3c,0x00,
	0x00,0x78,0x44,0x42,0x42,0x42,0x44,0x78,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x00,
	0x00,0x18,0x24,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x5a,0x66,0x26,0x19,0x00,
	0x00,0x78,0x44,0x42,0x42,0x42,0x44,0x78,0x50,0x48,0x48,0x44,0x44,0x42,0x42,0x00,
	0x00,0x18,0x24,0x42,0x40,0x40,0x20,0x10,0x08,0x04,0x02,0x02,0x42,0x24,0x18,0x00,
	0x00,0x7c,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x00,
	0x00,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x24,0x18,0x00,
	0x00,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x24,0x24,0x18,0x18,0x00,
	0x00,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x5a,0x5a,0x5a,0x24,0x24,0x24,0x00,
	0x00,0x42,0x42,0x42,0x24,0x24,0x24,0x18,0x18,0x24,0x24,0x24,0x42,0x42,0x42,0x00,
	0x00,0x82,0x82,0x44,0x44,0x28,0x28,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x00,
	0x00,0x7e,0x02,0x02,0x04,0x04,0x08,0x08,0x10,0x10,0x20,0x20,0x40,0x40,0x7e,0x00,
	0x00,0x3c,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3c,0x00,
	0x00,0x40,0x40,0x40,0x20,0x20,0x10,0x10,0x08,0x08,0x04,0x04,0x02,0x02,0x02,0x00,
	0x00,0x3c,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x3c,0x00,
	0x00,0x10,0x28,0x44,0x82,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7e,0x00,
	0x00,0x00,0x18,0x18,0x18,0x10,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x78,0x84,0x04,0x74,0x8c,0x84,0x8c,0x72,0x00,
	0x00,0x00,0x40,0x40,0x40,0x40,0x40,0x58,0x64,0x42,0x42,0x42,0x42,0x64,0x58,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1c,0x22,0x40,0x40,0x40,0x40,0x22,0x1c,0x00,
	0x00,0x00,0x04,0x04,0x04,0x04,0x04,0x34,0x4c,0x84,0x84,0x84,0x84,0x4c,0x34,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x38,0x44,0x82,0xfe,0x80,0x80,0x42,0x3c,0x00,
	0x00,0x00,0x0c,0x12,0x10,0x10,0x10,0x7c,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x3a,0x46,0x82,0x82,0x82,0x46,0x3a,0x02,0x44,0x38,
	0x00,0x00,0x40,0x40,0x40,0x40,0x40,0x58,0x64,0x42,0x42,0x42,0x42,0x42,0x42,0x00,
	0x00,0x00,0x00,0x10,0x10,0x00,0x00,0x30,0x10,0x10,0x10,0x10,0x10,0x10,0x38,0x00,
	0x00,0x00,0x08,0x08,0x00,0x00,0x18,0x08,0x08,0x08,0x08,0x08,0x08,0x48,0x48,0x30,
	0x00,0x00,0x40,0x40,0x40,0x40,0x40,0x42,0x44,0x48,0x50,0x70,0x48,0x44,0x42,0x00,
	0x00,0x00,0x30,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xec,0x92,0x92,0x92,0x92,0x92,0x92,0x92,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x5c,0x62,0x42,0x42,0x42,0x42,0x42,0x42,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x38,0x44,0x82,0x82,0x82,0x82,0x44,0x38,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x58,0x64,0x42,0x42,0x42,0x64,0x58,0x40,0x40,0x40,
	0x00,0x00,0x00,0x00,0x00,0x00,0x1a,0x26,0x42,0x42,0x42,0x26,0x1a,0x02,0x02,0x02,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x2c,0x32,0x20,0x20,0x20,0x20,0x20,0x20,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3c,0x42,0x40,0x30,0x0c,0x02,0x42,0x3c,0x00,
	0x00,0x00,0x00,0x00,0x20,0x20,0x20,0x78,0x20,0x20,0x20,0x20,0x20,0x24,0x18,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x42,0x42,0x42,0x42,0x42,0x42,0x46,0x3a,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x82,0x82,0x82,0x82,0x82,0x44,0x28,0x10,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x82,0x82,0x82,0x92,0x92,0xaa,0x44,0x44,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x82,0x44,0x28,0x10,0x10,0x28,0x44,0x82,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x42,0x42,0x42,0x42,0x42,0x22,0x14,0x08,0x10,0x60,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7e,0x02,0x04,0x08,0x10,0x20,0x40,0x7e,0x00,
	0x00,0x0c,0x10,0x10,0x10,0x10,0x10,0x20,0x20,0x10,0x10,0x10,0x10,0x10,0x0c,0x00,
	0x00,0x00,0x10,0x10,0x10,0x10,0x10,0x00,0x00,0x00,0x10,0x10,0x10,0x10,0x10,0x00,
	0x00,0x30,0x08,0x08,0x08,0x08,0x08,0x04,0x04,0x08,0x08,0x08,0x08,0x08,0x30,0x00,
	0x00,0x60,0x92,0x0c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

static	Uint32	color[7] = {
	0x00000000,/* 透明色になるところだから何を入れても良い */
	0x00000000,/* 黒 */
	0x00FFFFFF,/* 白 */
	0x00FF0000,/* 青 */
	0x0000FF00,/* 緑 */
	0x000000FF,/* 赤 */
	0x00008000 /* 深緑 */
};

void	ClrVram(volatile Uint8 *buff)
{
	Uint32	i;

	for(i=0;i<(512 * 512);i++)	buff[i]=0x00;
}


static	Uint8 *FNT_SerchFont8(Uint8 code)
{
	if(code >= 0x20 && code < 0x80)
	    return((Uint8 *)(FntAsciiFontData+((Uint32 )(code-0x20))*16));

	return((Uint8 *)FntAsciiFontData);
}

static	void  FNT_Print1Char256_8x16(volatile Uint8 *vram,Uint8 code,
									Uint16 x,Uint16 y,Uint16 col,Uint16 back)
{
Uint32	wx,wy,wp;
Uint32	i,j;
Uint8	*codep;

	codep = FNT_SerchFont8(code);

	wx = x;
	wy = y;

	wp = wx	+ wy * FntXsize;
	if(back < 256) {
	    for(i=0;i<16;i++) {
		for(j=0;j<8;j++) {
			if(codep[i] & FntBitPat[j])
				vram[wp]= (Uint8 )col;
			else
				vram[wp]= (Uint8 )back;
			wp++;
		}
		wp += (FntXsize - 8);
	    }
	}else{
	    for(i=0;i<16;i++) {
		for(j=0;j<8;j++) {
			if(codep[i] & FntBitPat[j])
				vram[wp]= (Uint8 )col;
			wp++;
		}
		wp += (FntXsize - 8);
	    }
	}
}

void  FNT_Print256(volatile Uint8 *vram,volatile Uint8 *str,Uint16 x,Uint16 y,
											Uint16 col,Uint16 back)
{
Uint32	i;
Uint16	wx,wy;

	wx = x;wy = y;
	if(wx > FntXsize)	wx = FntXsize/2 - strlen((Uint8 *)str)*4;

	i=0;
	while(str[i]) {
		if(str[i] > 0x80 && str[i] < 0xA0) {
			/* シフトＪＩＳ全角コードだったらスペースをあける。 */
			wx += 16;
			i++;
		}else if(str[i]=='\\'){
			i++;
			if(str[i]=='n') {
				wx = x;wy += 18;/* 改行 */
				if(wy > FntYsize-15)	return;
			}
		}else if(str[i]==0x0a) {
			wx = x;wy += 18;/* 改行 */
			if(wy > FntYsize-15)	return;
		}else{
			FNT_Print1Char256_8x16(vram,str[i],wx,wy,col,back);
			wx += 8;
		}
		if(wx+8 >= FntXsize) {
			wx = x;wy += 18;/* 改行 */
			if(wy > FntYsize-15)	return;
		}
		i++;
	}
}

#ifdef TITI
//--------------------------------------------------------------------------------------------------------------------------------------
int LoadFile(char *name, Uint8 *location, Uint32 size)
{
	Sint32 		fid, i;

	for (i = 0; i < 10; i++) {
		fid = GFS_NameToId(name);
		if (fid >= 0) {
			GFS_Load(fid, 0, location, size);
			return 0;
		}
	}
	return -1;
}
//--------------------------------------------------------------------------------------------------------------------------------------
void load_color_proms(char *name,unsigned short *palette)
{
	int i;
	unsigned char buffer[513];

	if (LoadFile(name, &buffer[0x000], 512)==0)
	{
		for(i=1;i<513;i+=2)
		{
			palette[(i-1)/2] = (buffer[i]>> 0) + (buffer[i-1] << 8);
		}
	}
}
//--------------------------------------------------------------------------------------------------------------
void VDP2_InitVRAM(void)
{
	/* Variables. */

	Uint32	loop;
	Uint32	maxloop;

	/* Code. */

	/* Fascist clear of all VDP2 VRAM */

	loop = 0;
	maxloop = 512*1024;

	while (loop < maxloop)
	{
		*((Uint32 *) (SCL_VDP2_VRAM_A0 + loop)) = 0;

		loop += 4;
	}

	/* Now set layer NBG1 to be a nice blue colour */

	loop = 0;
	maxloop = BITMAP_PIXEL_WIDTH * BITMAP_PIXEL_HEIGHT;

	while (loop < maxloop)
	{
		*((Uint8 *) (NBG1_VDP2_VRAM_BASE_ADDR + loop)) = 1;

		loop += 1;
	}
	
}
//--------------------------------------------------------------------------------------------------------------
/*
void	DispDate(char *comment,Uint16 x,Uint16 y)
{
	Uint8	*time;
	Uint8	buff[32];

	time = PER_GET_TIM();
#if 0 // 95/10/03 k.kawai 
	sprintf(buff,"%s%02x%02x-%02x-%02x %02x:%02x:%02x",comment,
#else
	sprintf((char *)buff,"%s%02x%02x-%02x-%02x %02x:%02x:%02x",comment,
#endif
			time[6],time[5],time[4] & 0x0F,time[3],
			time[2],time[1],time[0]);
// #if !(__GNUC__) 
#ifndef __GNUC__
	FNT_Print256((Uint8 *)SCL_VDP2_VRAM_B0,buff,x,y,20,0);
#else
	FNT_Print256((volatile Uint8 *)SCL_VDP2_VRAM_B0,buff,x,y,20,0);
#endif
}
*/

#endif

int main()
{
    Sint32 ret;
	Sint32 tno = 2;				// ＣＤ−ＤＡの先頭トラック番号 
//	Uint16	dummy_pad = 0;
//	int i = 0;
	Uint16		BackCol;
//	SclConfig	Nbg0Scfg;
    SclVramConfig	vramConfig;
	char FOLDERNAME[50], FNAME[50];
	
Uint16			cyclePat[] =
      			{
     				0x4444, 0xeeee,		// NBG0 - 512x512 bitmap - 256 colours - bank A 
					0x4444, 0xeeee,
					0x5555, 0xeeee,		// NBG1 - 512x512 bitmap - 256 colours - bank B 
					0x5555, 0xeeee					
				};

/*
Uint16			cyclePat[] =
      			{
     				0x4444, 0xeeee,		// NBG0 - 512x512 bitmap - 256 colours - bank A 
					0x4444, 0xeeee,
					0x5555, 0xeeee,		// NBG1 - 512x512 bitmap - 256 colours - bank B 
					0x5555, 0xeeee
				};
*/
	
//   	unsigned short palette[256];
/*	Uint8 bitmap_data[320 * 240];
	Uint8   	*VramWorkP;
	int l=0,x=0,j=0,y=0;
*/	SclConfig	config;

    /* ディレクトリ情報管理領域のsetup */
	*((Uint32 *)GFS_DDS_ADDR) = 0x20202020;
    GFS_DIRTBL_TYPE(&dirtbl) = GFS_DIR_NAME;
    GFS_DIRTBL_DIRNAME(&dirtbl) = dirname;
    GFS_DIRTBL_NDIR(&dirtbl) = MAX_DIR;

    /* ファイルシステムの初期化 */
    ret = GFS_Init(MAX_OPEN, lib_work, &dirtbl);
    if (ret <= 0) {
		/*	失敗すると、自分自身を起動する */
		exit(0);
    }

	*(volatile Uint16 *)0x25F80000 &= 0x7fff;
		
	set_imask(0);
	
    SCL_Vdp2Init();
   	SCL_SetColRamMode(SCL_CRM15_1024);
	SetVblank();

    SCL_SetFrameInterval(-1);

    SCL_DisplayFrame();
    SCL_DisplayFrame();

//	(void)LoadFile("MENU.BIN",(unsigned char *)&bitmap_data[0] , sizeof(bitmap_data));
//	load_color_proms("MENUPAL.BIN",&palette[0]);
	
//    SCL_AllocColRam(SCL_NBG0,256,OFF); 
//   	SCL_SetColRam(SCL_NBG0,0,256,palette);
	
	SCL_SetPriority(SCL_NBG1,5);
	SCL_SetPriority(SCL_NBG0,6);	

   	BackCol = 0x0000;
	SCL_SetBack(SCL_VDP2_VRAM+0x80000-2,1,&BackCol);

	/* Configure VDP2 VRAM */
	SCL_InitVramConfigTb(&vramConfig);
	vramConfig.vramModeA = ON;
	vramConfig.vramModeB = ON;
	SCL_SetVramConfig(&vramConfig);

	SCL_InitConfigTb(&config);
	config.dispenbl 	 = ON;
	config.bmpsize 		 = SCL_BMP_SIZE_512X512;
	config.coltype 		 = SCL_COL_TYPE_256;
	config.datatype 	 = SCL_BITMAP;
	config.mapover       = SCL_OVER_0;
	config.plate_addr[0] = SCL_VDP2_VRAM_A0;
	SCL_SetConfig(SCL_NBG0, &config);

	/*	VRAM Access Pattern Set            */
	SCL_SetCycleTable(cyclePat);	
	

	SCL_SetDisplayMode(SCL_NON_INTER,SCL_240LINE,SCL_NORMAL_A);
	
	SCL_SetFrameInterval(1);	
	VDP2_InitVRAM();
	
	PER_SMPC_RES_ENA();/* リセットボタン有効 */
	FNT_SetBuffSize(512,256,1);
/*
	VramWorkP = (Uint8 *)SCL_VDP2_VRAM_A0;
	l=0;
	j=0;
	
    for (y = 0; y < 240; y++)
    {
        for (x = 0; x < 320; x++, l++,j++)
        {
            VramWorkP[l] = bitmap_data[j];
        }
        l += 192;   
    }*/
    
    changePic("MENU");

	SCL_Open(SCL_NBG0);
		SCL_MoveTo(FIXED(0), FIXED(0),0);
		SCL_Scale(FIXED(1.0), FIXED(1.0));
	SCL_Close();

	while (FOLDERNAME[0] == '\0')
	{
		SCL_DisplayFrame();
		toto(FOLDERNAME);
		
		if (FOLDERNAME[3] == '5')
		  vbt(FOLDERNAME);
        else if (FOLDERNAME[0] != '\0')
		  titi(FOLDERNAME);        
	}

	ClrVram((volatile Uint8 *)SCL_VDP2_VRAM_A0);
	sprintf(FNAME,"%s_IP.BIN",FOLDERNAME);
	set_imask(0);

	/* Ｖブランクの設定 */
	INT_ChgMsk(INT_MSK_NULL,INT_MSK_VBLK_IN | INT_MSK_VBLK_OUT  |INT_MSK_PAD);

	ret = FLD_ExecGame(FNAME,FOLDERNAME,tno);

	if (ret == NG) {
    SetVblank();

	ClrVram((volatile Uint8 *)SCL_VDP2_VRAM_A0);
	FNT_Print256((volatile Uint8 *)SCL_VDP2_VRAM_A0,
		(Uint8 *)"Boot Menu -Error",40,10,2,0);
	}
    return 0;
}
//---------------------------------------------------------------------------------------------
void vbt(char *toto)
{	
	int type, ok = 0;

	changePic(toto);
   //---------------------------------------------------------------------------------------------
	while (!ok)
	{
    	device = PER_GetDeviceR( &__port[0], 0 );
        type = PER_GetType( device );
    
    	pltriggerE[0] = pltrigger[0];
    
    	pltrigger[0] = PER_GetTrigger( device );
    	pltriggerE[0] = (pltrigger[0]) ^ (pltriggerE[0]);
    	pltriggerE[0] = (pltrigger[0]) & (pltriggerE[0]);
    
    	SCL_DisplayFrame();
    
    	switch(pltriggerE[0])
    	{
    		case PER_DGT_TB:
    		    ok = 1;
    			toto[0]='\0';
    			toto[3]=NULL;
    			break;
    		case PER_DGT_TC:
                sprintf(toto,"APP5");
    		    ok = 1;		
    			break;    			
    		case PER_DGT_TX:
                sprintf(toto,"APP7");
    		    ok = 1;		
    			break;
    		case PER_DGT_TY:
                sprintf(toto,"APP8");
    		    ok = 1;		
    			break;    			
    		case PER_DGT_TZ:
                sprintf(toto,"APP9");
    		    ok = 1;		
    			break;    			
    		default:
    		    ok = 0;	
    			break;
    	}
    	
   	}
   	changePic("MENU");
}
//---------------------------------------------------------------------------------------------
void titi(char *toto)
{	
	int type, ok = 0;

	changePic(toto);
   //---------------------------------------------------------------------------------------------
	while (!ok)
	{
    	device = PER_GetDeviceR( &__port[0], 0 );
        type = PER_GetType( device );
    
    	pltriggerE[0] = pltrigger[0];
    
    	pltrigger[0] = PER_GetTrigger( device );
    	pltriggerE[0] = (pltrigger[0]) ^ (pltriggerE[0]);
    	pltriggerE[0] = (pltrigger[0]) & (pltriggerE[0]);
    
    	SCL_DisplayFrame();
    
    	switch(pltriggerE[0])
    	{
    		case PER_DGT_TB:
    		    ok = 1;
    			toto[0]='\0';
    			toto[3]=NULL;    			
    			break;
    		case PER_DGT_ST:
    		    ok = 1;		
    			break;
    		default:
    			break;
    	}
   	}
   	changePic("MENU");
}
//---------------------------------------------------------------------------------------------
void toto(char *titi)
{	
	int type;

	device = PER_GetDeviceR( &__port[0], 0 );
    type = PER_GetType( device );

	pltriggerE[0] = pltrigger[0];

	pltrigger[0] = PER_GetTrigger( device );
	pltriggerE[0] = (pltrigger[0]) ^ (pltriggerE[0]);
	pltriggerE[0] = (pltrigger[0]) & (pltriggerE[0]);

	SCL_DisplayFrame();

	switch(pltriggerE[0])
	{
		case PER_DGT_TA:
			sprintf(titi,"APP1");
			break;
		case PER_DGT_TB:
			sprintf(titi,"APP2");
			break;
		case PER_DGT_TC:
			sprintf(titi,"APP3");
			break;
		case PER_DGT_ST:
			break;
		case PER_DGT_TX:
			sprintf(titi,"APP4");
			break;
		case PER_DGT_TY:
			sprintf(titi,"APP5");
			break;
		case PER_DGT_TZ:
			sprintf(titi,"APP6");
			break;
		case PER_DGT_TR:
		case PER_DGT_TL:
			break;
	}

	if (titi[0]!='\0')
	{
		ClrVram((volatile Uint8 *)SCL_VDP2_VRAM_A0);
		FNT_Print256((volatile Uint8 *)SCL_VDP2_VRAM_A0,
			(Uint8 *)titi,40,10,2,0);
	}
}
//---------------------------------------------------------------------------------------------
void changePic(char *fileName)
{
   	unsigned short palette[256];
	Uint8 bitmap_data[320 * 240];
	Uint8 *VramWorkP;
	int l=0,x=0,j=0,y=0;
	char xx[50];
	
//---------------------------------------------------------------------------------------------
    sprintf(xx,"%s.BIN",fileName);
	(void)LoadFile(xx,(unsigned char *)&bitmap_data[0] , sizeof(bitmap_data));
    sprintf(xx,"%sPAL.BIN",fileName);
	load_color_proms(xx,&palette[0]);
	
    SCL_AllocColRam(SCL_NBG0,256,OFF); 
   	SCL_SetColRam(SCL_NBG0,0,256,palette);
   	
	VramWorkP = (Uint8 *)SCL_VDP2_VRAM_A0;
	l=0;
	j=0;
	
    for (y = 0; y < 240; y++)
    {
        for (x = 0; x < 320; x++, l++,j++)
        {
            VramWorkP[l] = bitmap_data[j];
        }
        l += 192;   
    }
}
//---------------------------------------------------------------------------------------------
